#!/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin

touch /etc/runit/stopit
chmod 0 /etc/runit/stopit

echo "UEBO: Generating ld cache"
ldconfig

echo "UEBO: Removing kernel module dir to save lots of memory"
rm -rf /lib/modules/*

echo "UEBO: Setting up all available gettys based on /proc/consoles"
for i in $(cat /proc/consoles | cut -d" " -f1); do
        echo "UBO: Preparing getty on $i"
        cp -rp /etc/service.d/getty /etc/service/tty-${i}
done

echo "UEBO: Setting hostname"
if [ -f /etc/hostname ]; then
	hostname=$(cat /etc/hostname)
	echo $hostname > /proc/sys/kernel/hostname
	echo "127.0.0.1 $hostname localhost" > /etc/hosts
else
	echo "uebo" > /proc/sys/kernel/hostname
	echo "127.0.0.1 uebo localhost" > /etc/hosts
fi

echo "UEBO: Preparing user runtime"
touch /var/log/lastlog
